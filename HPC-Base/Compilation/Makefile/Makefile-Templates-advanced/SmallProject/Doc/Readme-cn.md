# 小型工程的 Makefile

## 语言选项

[English](./Readme.md) | [简体中文](./Readme-cn.md)

## 简介

这是一个针对**小型工程**的Makefile模板，我们定义的小型工程是指:

- 只有 **一个** **一层的** 源代码文件夹(即此文件夹下的任何子文件夹中不包含与编译有关的源文件)
- 只有一个目标需要构建

## 如何使用

使用此模板时，将 `Template` 目录下的 Makefile 模板复制到您的工程文件夹下，根据 `Example` 中提供的样例与下述指导来修改 Makefile 的内容，即可完成移植。

## 情景描述

如果一个工程的目录/源代码组织形式符合如下描述，那么我们称其为**小型工程**:

- 根目录:
  - bin 目录: 包含目标文件
  - obj 目录: 包含所有中间文件
  - src: 包含**所有**与编译有关的源文件
    - **注意**: src 目录下的子文件夹中不应包含任何与编译有关的源文件，如有，请移动到 src 的根目录下

## 工作流程

在根目录执行 `make`，其生成目标文件依赖于 `OBJ`

`OBJ` 根据 `SRC` 来生成所有的目标文件名，而 `SRC` 是通过搜索 `SRC_PATH` 下所有符合模式 *.c\** 的文件而实现(*.c*, *.cpp*, *.cc* 等文件均会被包括)

如果 `OBJ` 中有任何过时/没有生成的中间文件，会首先生成对应中间文件，然后重新生成目标文件

## 问题与讨论

1. `SRC_PATH` 的子目录是否可以放置编译相关的源文件
    1. 一般来讲，可以这么做，仅需针对 Makefile 中的 `SRC` 生成方式做少量递归化改动即可
    1. 但是我并不建议这么做，这样会隐藏文件名冲突的问题，即如果在不同文件夹下有相同名称的源文件，使用这样一个 Makefile 无法在编译时提示你中间文件重复/覆盖，仅会提示一些与链接有关的问题(如找不到一些函数原型)
    1. 如果您的工程比当前问题描述的工程更加复杂，建议您查看**中型工程**或者**大型工程**的 Makfile 模板
1. 为何将所有中间文件放到同一目录?
    1. 因为我们针对的是简单的小工程，将所有中间文件放到同一目录方便进行链接与清理
1. 在 Windows 下编译需要注意什么事情
    1. 你或许需要显式指定 `make` 工具的路径，如`MAKE := C:/.../make.exe`
    1. `TARGET` 应当以 *.exe* 结尾, 如果不这么做，一些情况下 `make` 或者编译器会替你这么做，进一步导致清理时对应的规则失效，这个生成的目标文件无法被正确清理
    1. 请不要使用 UNIX 风格的 `find` 功能，如果确实需要使用类似功能，请参考 Windows 下的相关命令，或者参考**中型工程**模板中的递归查找函数 `rwildcard`